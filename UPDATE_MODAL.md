# モーダル動作の改善 ✅

## 変更内容

### Web版と同じ動作に変更

**旧動作**:
- 未マーク＆写真なし → 写真プロンプト表示
- それ以外 → マークの切り替え

**新動作** (Web版準拠):
- **マスをタップ → 常にモーダル表示**
- モーダル内で写真アップロード、マーク、削除などの操作を選択

---

## 新しいモーダルの機能

### マス詳細モーダル

マスをタップすると、以下の要素を含むモーダルが表示されます：

1. **ヘッダー**
   - お題の絵文字（大きく表示）
   - お題のテキスト

2. **写真エリア**
   - 既存の写真がある場合 → 写真を表示
   - 写真削除ボタン

3. **アクションボタン**
   - 📷 写真をアップロード / 写真を変更
   - ✓ マークする / マーク済み

### 操作の流れ

#### パターン1: 写真をアップロードする
```
1. マスをタップ
   ↓
2. モーダル表示
   ↓
3. 「📷 写真をアップロード」をタップ
   ↓
4. 写真を選択（自動圧縮）
   ↓
5. プレビュー表示
   ↓
6. 「💾 保存してマーク」をタップ
   ↓
7. 写真保存 + 自動マーク + モーダル閉じる
```

#### パターン2: 写真なしでマークする
```
1. マスをタップ
   ↓
2. モーダル表示
   ↓
3. 「✓ マークする」をタップ
   ↓
4. マーク + モーダルは開いたまま
```

#### パターン3: 既存の写真を見る・削除する
```
1. マスをタップ
   ↓
2. モーダル表示（写真が表示される）
   ↓
3. 「🗑️ 写真を削除」をタップ
   ↓
4. 確認ダイアログ → 削除 → モーダル更新
```

#### パターン4: 写真を変更する
```
1. マスをタップ（既に写真がある）
   ↓
2. モーダル表示（既存写真が表示される）
   ↓
3. 「📷 写真を変更」をタップ
   ↓
4. 新しい写真を選択
   ↓
5. プレビュー表示（既存写真は非表示）
   ↓
6. 「💾 保存してマーク」で上書き
```

---

## UI の改善

### マークボタンの状態
- **未マーク**: `✓ マークする` (グレー)
- **マーク済み**: `✓ マーク済み` (グリーン)
- クリックでトグル可能

### 写真アップロードボタンの状態
- **写真なし**: `📷 写真をアップロード`
- **写真あり**: `📷 写真を変更`

---

## 右クリック/長押し機能（既存）

モーダルを開かずに写真を素早く確認したい場合：
- **PC**: 右クリック → 写真を拡大表示
- **スマホ**: 長押し → 写真を拡大表示

---

## 動作確認

http://localhost:59457 で以下を確認:

1. ✅ マスをタップ → モーダルが開く
2. ✅ モーダル内でお題の絵文字とテキストが表示
3. ✅ 「📷 写真をアップロード」で写真を選択
4. ✅ プレビュー → 「💾 保存してマーク」で保存
5. ✅ 「✓ マークする」でマークのみ
6. ✅ 既存の写真がある場合は表示される
7. ✅ 「🗑️ 写真を削除」で削除
8. ✅ 「📷 写真を変更」で写真の差し替え
9. ✅ 右クリックで写真を拡大表示（既存機能）

---

## まとめ

**Web版と同じ動作になりました！** 🎉

- マスをタップすると**必ずモーダルが開く**
- モーダル内で**写真アップロード、マーク、削除**などを選択
- 直感的でわかりやすい操作

ブラウザをリロードして動作確認してください！
