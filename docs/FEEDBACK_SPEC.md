# お散歩ビンゴ フィードバック対応仕様（一個ずつ）

ユーザーからの意見を一個ずつ仕様化したドキュメント。実装順は別途検討。

---

## 1. ビンゴ中の画面上部「グループで楽しむ散歩ゲーム」を取る

| 項目 | 内容 |
|------|------|
| **現状** | `game.html` の `.subtitle` で「グループで楽しむ散歩ゲーム」を常時表示している |
| **変更** | ゲーム画面（ビンゴプレイ中）のヘッダーからこのサブタイトルを削除する |
| **対象** | `game.html` の `<p class="subtitle">グループで楽しむ散歩ゲーム</p>` を削除 |
| **備考** | OGP・meta の「グループで楽しむ」はランディング用なのでそのままでよい |

---

## 2. 写真撮影後、一番大きいボタンを「写真をアップロード」→「この写真でマーク」に変更

| 項目 | 内容 |
|------|------|
| **現状** | マスをタップ→セルモーダルで「📷 写真を撮る・選ぶ」（JSで「写真をアップロード」「写真を変更」に書き換え）。写真選択後はプレビュー＋「保存してマーク」「撮り直し」が出るが、**プレビュー表示中もメインの大きなラベルは「写真をアップロード」のまま** |
| **変更** | 写真を選んだ直後（プレビュー表示中）、**一番大きいボタン**を「この写真でマーク」にし、押したら保存＋マーク＋モーダル閉じる動きにする |
| **具体** | ・`cellPhotoPreview` 表示時：メインCTAを「この写真でマーク」に変更（`uploadPhotoLabel` の表示テキストとクリック時の挙動を「ファイル選択」ではなく「保存してマーク」に寄せる、または `saveCellPhotoBtn` を大きくしてメインにする）<br>・「写真なし」のとき：「写真を撮る・選ぶ」または「写真をアップロード」のまま |
| **備考** | 現在の「💾 保存してマーク」を「一番大きいボタン」として扱い、ラベルを「この写真でマーク」に統一してもよい |

---

## 3. 1マス内のお題の位置を下揃えにする

| 項目 | 内容 |
|------|------|
| **現状** | `.bingo-cell` が `display: flex; flex-direction: column; align-items: center; justify-content: center;` で中央揃え |
| **変更** | セル内のアイコン＋テキストを**下揃え**にする |
| **具体** | `.bingo-cell` の `justify-content: center` を `justify-content: flex-end` に変更。必要に応じて `padding-bottom` で下余白を一定にする |
| **対象** | `styles.css` の `.bingo-cell` |

---

## 4. 最初に写真モードかマーク式かを選ばせる。1マス都度確認しない

| 項目 | 内容 |
|------|------|
| **現状** | マスをタップするたびに、写真撮影・アップロードと「マークする」の両方が出るモーダルが開く（毎回どちらでも選べる） |
| **変更** | **ゲーム開始前（合言葉・設定の流れ）で一度だけ**「写真で記録するモード」か「マークだけするモード」を選択する。ゲーム中はそのモードに従い、**マスをタップしたときの動きを分ける** |
| **具体** | ・作成/参加フローに「遊び方」選択を追加：例）「📷 写真で記録」「✓ マークだけ」<br>・保存する state: 例 `playMode: 'photo' | 'markOnly'`<br>・`playMode === 'markOnly'` のとき：マスタップでモーダルを出さずにその場でマークON/OFF（または簡易モーダルでマークのみ）<br>・`playMode === 'photo'` のとき：現行どおり写真撮影・アップロード＋マークのモーダル |
| **備考** | 既存の「写真付きで遊んでいる」データは `playMode: 'photo'` として扱うと互換しやすい |

---

## 5. 一回始めると最初の設定画面にもう一度行けないのを修正

| 項目 | 内容 |
|------|------|
| **現状** | ゲーム開始後は「作り直す」でお題シャッフルのみ。合言葉・人数・難易度・フリー入力などの**初期設定画面（合言葉モーダル）に戻る入口がない** |
| **変更** | プレイ中に「設定に戻る」などで**最初の設定モーダルを再度開ける**ようにする |
| **具体** | ・ヘッダーまたは統計エリアに「設定」ボタンを追加し、押したら `showRoomCodeModal()` を呼ぶ（現在の合言葉・人数・難易度などを表示した状態でモーダルを開く）<br>・「設定に戻る」でモーダルを開いた場合、設定変更後に「反映する」でボードを再生成するか、そのまま閉じるかは仕様で決める（例：合言葉変更時は「新しいゲームとして開始」とみなす） |
| **備考** | 「作り直す」は現状どおりお題シャッフルのみ。「設定」は部屋設定の再編集・確認用 |

---

## 6. 記入フリーマスと真ん中のFREEマス名前が同じなので、真ん中の「FREE」削除。説明も合わせて変更

| 項目 | 内容 |
|------|------|
| **現状** | ・中央マス：表示テキストが「FREE」、説明は「中央のマスは最初からマーク済みです」<br>・ユーザーが自分でお題を入れるマス：説明で「✏️マス」「フリーお題」など。どちらも「フリー」という語が使われて紛らわしい |
| **変更** | ・**中央マス**：画面上の表示から「FREE」という文字をやめる（アイコンのみ表示、または何も表示しない）<br>・**説明文**：中央マスは「中央のマスは最初からマーク済みです」のみ。記入用マスは「✏️マス：自分でお題を決められるマス」など、中央マスと区別できる表現にする |
| **具体** | ・`app.js` の中央マス用 `topic` の `text` を空文字にするか、`renderBoard` で index=12 のときテキストを出力しない<br>・`game.html` の「詳しい説明」内「FREE」の行を削除し、中央マスは「中央のマスは最初からマーク済み」のような1行に。✏️マスの説明で「フリー」を避け「自分でお題を決めるマス」などに統一 |
| **備考** | データ上は `isFree: true` のまま。表示だけ「FREE」を出さない |

---

## 7. 合言葉を決める際、グループ内でお題が被らないことをうたう

| 項目 | 内容 |
|------|------|
| **現状** | 合言葉を決めて参加する説明はあるが、「同じ合言葉なら同じお題（同じボード）になる」ことが明示されていない |
| **変更** | 合言葉入力・作成の画面で「**同じ合言葉で参加すると、みんな同じお題のビンゴで遊べます**」のように、グループ内でお題が被る（揃う）ことを一文でうたう |
| **具体** | `game.html` の「ゲームを作る」「ゲームに参加」の説明文またはフォームヘルプに上記の文言を追加 |
| **備考** | 実装は文言追加のみ。シードの仕様は現状のまま（合言葉がシードになっている想定） |

---

## 8. 終了時に今回のプレイ時間を入れられたらよい

| 項目 | 内容 |
|------|------|
| **現状** | 結果画面に日付・誰と遊んだかはあるが、プレイ時間（何分遊んだか）はない |
| **変更** | 終了（結果）時に**今回のプレイ時間**を入力または自動表示できるようにする |
| **具体** | ・案A：ゲーム開始時刻を保存し、終了時に経過時間を自動表示（例「プレイ時間 約○分」）<br>・案B：結果編集エリアで「プレイ時間」を入力欄で記入（例 30分）<br>・結果キャプチャ・共有用のテキストや画像に「プレイ時間」を含める |
| **備考** | 自動計測なら開始時刻の保存が必要。入力式ならUIが簡単。どちらかまたは両方で仕様を確定する |

---

## 9. 個人を特定できる情報のアップロード・共有に関する注意文

| 項目 | 内容 |
|------|------|
| **現状** | 写真アップロード時・結果画面の保存・共有時に、個人特定につながる内容についての注意がない |
| **変更** | **写真アップロード時**と**結果のSNS共有時**の2箇所で、個人を特定できる情報（例：ナンバープレート、顔など）のアップロードや共有を控えるよう注意を促す記載を入れる。 |
| **表示箇所** | ・**写真アップロード時**：マス詳細モーダル（セルモーダル）内。写真を撮る・選ぶ／アップロードするボタン付近に短い注意文を表示。<br>・**SNS共有時**：リザルト画面の「画像を保存」「共有する」ボタン付近に注意文を表示。 |
| **文言方針（案）** | ・共通で使える短い文：**「個人が特定できる写り込み（ナンバープレート・顔など）はアップロード・共有しないでください。」**<br>・写真アップロード時：「撮影・アップロード時は、ナンバープレートや顔など個人が特定できる写り込みにご注意ください。」<br>・SNS共有時：「個人が特定できる写真はSNSに上げないでください。（ナンバープレート・顔など）」<br>※ 文言は運用で調整可。 |
| **具体** | ・`game.html` の `cellModal`（マス詳細モーダル）内、写真ボタンエリアの上または下に注意用の `.cell-modal-notice` を追加。<br>・`game.html` の `resultShareArea` 内、`result-share-buttons` の上または下に `.result-notice` を追加。<br>・スタイルは小さめの補足テキスト（font-size 0.85rem 程度、色はグレー系）。 |
| **備考** | 法的な表記が必要な場合は別途確認。両方のタッチポイントで同じ趣旨を伝えることで、アップロード時と共有時の両方でリスクを抑える。 |

---

## 10. バトルモード（陣取り合戦）仕様（私用・精査用）

### 前提
- お題アイデアは**数百個**用意予定のため、通常は**重複しない**前提でよい。
- グループを組む用途は**2つ**：
  - **自由記入マスの内容共有**（配置はランダム）：同じ部屋で「フリーお題」の内容だけ共有し、並びは各自ランダム。
  - **陣取り合戦**：同じシート（同じお題配置）をグループで共有し、先に取ったマスの所有権を争う。

### バトル概要（陣取り合戦）
- **同じシート内容**をグループ内で共有する（合言葉＝同じシードで同じ25マス）。
- **先にそのマスを取った人**が、そのマスの**所有権**を得る。
- 一度取られたマスは**他の人は取れない**（取り返し不可）。
- 勝敗は「ビンゴ本数」「取得マス数」などで判定（詳細は別途）。

### 発展形（将来）
- グループ内で**敵味方・陣営分け**（例：Aチーム vs Bチーム）。陣営ごとにマスを奪い合い、陣営単位のビンゴやスコアを競う。

### 実装上の検討事項
- **リアルタイム同期**：誰がいつどのマスを取ったかを全員に反映するには、WebSocket 等のリアルタイム通信またはポーリングが必要。
- **自由記入マス**：バトル時は「フリーお題の文言だけ共有・配置はランダム」とすると、陣取りの「同じシート」と矛盾する。案：バトルモード時はフリー枠を「共通シードで固定されたお題」に置き換える、またはバトルではフリー枠を0にして全マス共通お題にする。
- まずは**陣取りルールとデータ構造**（マスごとの owner 情報）を固めてから、通信方式を選ぶ。

### リアルタイム不要案（検証結果）

**方針**：完全リアルタイム同期は必須ではない。「**そのマスにすでに写真がアップロードされていたら取れない**」とすれば、**写真アップロードのタイミング**でサーバーに「このマスを取る」を送り、サーバーが「未取得なら受理・保存」「取得済みなら却下」するだけでよい。

| 項目 | 内容 |
|------|------|
| **所有権の定義** | 「そのマスに写真をアップロードした人」がそのマスの所有者。すでに誰かが写真をアップロード済みのマスは、他の人は取れない（アップロード不可 or タップ時に「すでに取られています」と表示）。 |
| **同期のタイミング** | ・**ボード表示時**：部屋の「マスごとの取得状況」（誰がどのマスを取ったか、または「写真あり」の一覧）をAPIで取得して表示する。<br>・**写真アップロード時**：アップロード送信と同時に「このマスを取得」リクエストを送る。サーバーが未取得なら受理し、取得済みならエラーを返す。クライアントはエラー時に「このマスはすでに取られていました」と表示。<br>・WebSocket・ポーリングは**不要**。画面を開いたとき・写真を送ったときのリクエストだけで足りる。 |
| **解決できること** | ・リアルタイム配信なしで「先に取った人が所有者」を実現できる。<br>・バックエンドは「部屋＋マスごとの取得者」を保存するAPI（GET 取得状況、POST マス取得）があればよい。<br>・「すでに画像がアップロードされていたら取れない」は、サーバーが「そのマスに既に所有者がいるか」を返すことで実現可能。 |
| **注意点** | ・取得状況の表示は「画面を開いた時点」「写真送信後」の情報になるため、別の人がその間に取っていても、自分の画面は次回の取得まで更新されない。ルールとして「写真を送ろうとしたら取られていた」で却下されることはある、と明記すればよい。<br>・マークのみ（写真なし）で取る可否は別途決める。例：「バトルでは写真アップロードがあった時点で取得」とすれば、マークだけでは取れない。 |

**結論**：**リアルタイムでなくても実現可能**。写真アップロード＝取得申告とし、サーバー側で先着1件だけ受理する形にすれば、ポーリングやWebSocketは不要。

### 懸念事項・難易度

| 懸念 | 難易度 | メモ |
|------|--------|------|
| **バックエンド必須** | 中 | 現状はフロント＋LocalStorageのみ。「誰がいつ取ったか」の**正を握る**のはサーバー側になるため、静的サイトのままでは陣取りの公平性を保てない。Firebase / Supabase / 自前API のいずれかが必要。 |
| **「先に取った」の判定** | 中 | クライアントの時刻は改ざん可能。**サーバーで受信した時刻**で先着を決める必要がある。実装は「マス取得リクエストをサーバーが1件だけ受理し、他は却下」にすればよい。 |
| **通信遅延・同時押し** | 低〜中 | 二人がほぼ同時に同じマスを押した場合、片方に「すでに取られていました」と表示する必要がある。サーバー側で楽観ロックやトランザクションで1マス1所有者にすれば解決可能。 |
| **オフライン・再接続** | 中 | 散歩中は通信が不安定になりがち。オフライン中に取った扱いにするか、オンライン復帰時に競合をどう解消するかはルール設計次第（例：バトル中はオンライン前提と明記する）。 |
| **陣営分け（発展形）** | 低〜中 | ユーザーをチームに割り当て、マス所有者をチーム単位で集計するだけなので、データ構造を拡張すれば実装可能。マッチング（誰をどの陣営にするか）のUIがやや手間。 |
| **コスト・運用** | 要検討 | リアルタイムDB・API を立てると、無料枠で収まるか・課金した場合の目安を事前に確認した方がよい。 |

**結論**：**「解決が原理的に不可能」なものはない**。**リアルタイム不要案**（写真アップロード＝取得申告・サーバーで先着1件のみ受理）を採用すれば、WebSocketは不要で、バックエンドは「取得状況のGET」と「マス取得のPOST」があれば足りる。難易度が高いのは「バックエンドをどう持つか」の選定と、オフライン時のルール設計。

---

## 11. LP（index）以外のヘッダーを削除してスペースを確保

| 項目 | 内容 |
|------|------|
| **現状** | 全ページで `global-header`（Bingo Party / お散歩ビンゴ）が固定表示され、`body` に `padding-top: 52px` が効いている |
| **変更** | **LP（index.html）以外**ではグローバルヘッダーを**表示しない**。ゲーム画面などで上方向のスペースを広くする |
| **具体** | ・`game.html` から `<header class="global-header">...</header>` を削除<br>・ヘッダーがないページでは `body` の `padding-top` を 0 にする（例：`body` に `class="page-game"` を付け、`.page-game { padding-top: 0 }` を適用）<br>・トップへ戻るは各ページの「← トップへ戻る」リンクで対応 |
| **備考** | 今後他に LP 以外のページが増えた場合も、そのページではグローバルヘッダーを出さない方針とする |

---

## 12. マス間・シート枠とマスの余白を詰めて1マスを大きくする

| 項目 | 内容 |
|------|------|
| **現状** | `.bingo-board` の `gap: 10px`、`padding: 16px`。`.bingo-cell` の `padding: 8px`。マスとマスの間・シートの枠とマスの間に余白があり、1マスあたりのサイズが小さめ |
| **変更** | マスとマスの**間の隙間**と、**シート枠とマスの間の余白**をできるだけ詰め、**1マス単位のサイズを大きく**する |
| **具体** | ・`.bingo-board`：`gap` を 10px → 4px（または 6px）、`padding` を 16px → 6px〜8px に縮小<br>・`.bingo-cell`：`padding` を 8px → 4px に縮小<br>・メディアクエリ内の `.bingo-board` の gap・padding も同様に詰める |
| **備考** | タップしやすさを損なわない程度に詰める。極小画面ではさらに gap を 3px などにしてもよい |

---

## 13. グループ＋自由記載マスのとき「参加者からランダムで選んだ人の記載を回す」

| 項目 | 内容 |
|------|------|
| **要望** | 合言葉でグループを作り、かつ自由記載マスがある場合、参加者の中からランダムで選出したメンバーが記載した内容を、他の参加者に「回す」（各自のボードの自由記載マスに、誰か別の人のお題が入るようにする） |
| **現状** | 作成者のみが自由記載を入力し、参加者は自由記載0でボード作成。参加者同士でお題を集約する仕組みがない（サーバーなし） |
| **変更（実装済み）** | ・参加画面に「✏️ フリー入力マス」の数選択と入力欄を追加。作った人に数とお題を聞き、同じお題セットを入力して参加できる。<br>・同じお題セットを使うと、合言葉＋userId でシャッフルされるため、**各自ボード上のどのマスにどのお題が入るかは人ごとに異なる**（お題の「並びを回す」形になる） |
| **制約** | **厳密に「誰が書いたお題を誰に回す」**を行うには、全員の記載を集約しランダムに割り当てる必要があるため、**バックエンドまたは手動での集約**が必要。現状は「作った人から教えてもらった同じお題セット」を参加者が入力し、並びだけが各自で異なる方式で対応。 |
| **方針** | **「部屋を作る→合言葉で集める→空白マスを参加者に割り当てて入力→集約してビンゴ」のフルフローは、バトルビンゴを実装するとき以外は行わない。** 静的なみでの実装は集約ができないため限界があり、バックエンドが必要になる。検証の詳細は `docs/VERIFY_GROUP_FREE_MASU_FLOW.md` に保管。バトルビンゴ実装時に同 doc を参照して設計する。 |

---

## 実装優先度の目安（案）

| 優先度 | 番号 | 理由（目安） |
|--------|------|----------------|
| 高 | 1, 2, 3, 5, 6, 9, 11, 12 | UI・文言・スペース確保。11・12は即効性あり |
| 中 | 4, 7 | フロー変更・説明追加。4は状態追加が必要 |
| 要検討 | 8 | プレイ時間は自動/手動で仕様を詰める |
| 別枠 | 10 | 陣取り合戦＋発展形。リアルタイム同期・データ構造の検討が必要 |
| 実施しない（バトルビンゴ時のみ） | 13 のフルフロー | 部屋→集める→割り当て→集約→ビンゴ。検証は `VERIFY_GROUP_FREE_MASU_FLOW.md` 参照 |

---

このドキュメントは、フィードバックを一個ずつ仕様化したものです。実装時に不足があればここに追記してください。
